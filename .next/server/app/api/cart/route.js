"use strict";(()=>{var e={};e.id=453,e.ids=[453],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},80330:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>I,patchFetch:()=>g,requestAsyncStorage:()=>f,routeModule:()=>y,serverHooks:()=>v,staticGenerationAsyncStorage:()=>_});var i={};r.r(i),r.d(i,{GET:()=>w,PATCH:()=>h,POST:()=>x});var s=r(49303),n=r(88716),a=r(60670),o=r(87070),d=r(75571),u=r(23174),c=r(77051),l=r(21067);let p=l.Ry({productId:l.Z_(),size:l.Z_().optional(),qty:l.Rx().int().min(1).max(99)}),m=l.Ry({lines:l.IX(p)});async function q(e){let t=await c._.cart.findUnique({where:{userId:e},include:{lines:!0}});return t||(t=await c._.cart.create({data:{userId:e},include:{lines:!0}})),t}async function w(){let e=await (0,d.getServerSession)(u.L),t=e?.user?.id;if(!t)return o.NextResponse.json({lines:[]});let r=await c._.cart.findUnique({where:{userId:t},include:{lines:!0}});return o.NextResponse.json({lines:(r?.lines||[]).map(e=>({productId:e.productId,size:e.size||void 0,qty:e.qty,priceCentsSnapshot:e.priceCentsSnapshot}))})}async function x(e){let t=await (0,d.getServerSession)(u.L),r=t?.user?.id;if(!r)return o.NextResponse.json({error:"unauthenticated"},{status:401});let i=await e.json().catch(()=>null),s=m.safeParse(i);if(!s.success)return o.NextResponse.json({error:"invalid_payload"},{status:400});let n=await q(r);await c._.cartLine.deleteMany({where:{cartId:n.id}});let a=await Promise.all(s.data.lines.map(async e=>{let t=await c._.product.findUnique({where:{id:e.productId}});return t?c._.cartLine.create({data:{cartId:n.id,productId:t.id,size:e.size,qty:e.qty,priceCentsSnapshot:t.priceCents}}):null}));return o.NextResponse.json({ok:!0,created:a.filter(Boolean).length})}async function h(e){let t=await (0,d.getServerSession)(u.L),r=t?.user?.id;if(!r)return o.NextResponse.json({error:"unauthenticated"},{status:401});let i=await e.json().catch(()=>null),s=m.safeParse(i);if(!s.success)return o.NextResponse.json({error:"invalid_payload"},{status:400});let n=await q(r);for(let e of s.data.lines){let t=await c._.product.findUnique({where:{id:e.productId}});if(!t)continue;let r=await c._.cartLine.findFirst({where:{cartId:n.id,productId:e.productId,size:e.size||null}});r?await c._.cartLine.update({where:{id:r.id},data:{qty:Math.min(99,r.qty+e.qty)}}):await c._.cartLine.create({data:{cartId:n.id,productId:t.id,size:e.size,qty:e.qty,priceCentsSnapshot:t.priceCents}})}let a=await c._.cart.findUnique({where:{id:n.id},include:{lines:!0}});return o.NextResponse.json({lines:a?.lines.map(e=>({productId:e.productId,size:e.size||void 0,qty:e.qty,priceCentsSnapshot:e.priceCentsSnapshot}))||[]})}let y=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/cart/route",pathname:"/api/cart",filename:"route",bundlePath:"app/api/cart/route"},resolvedPagePath:"/Users/ishaqbello/Website/asos-clone/app/api/cart/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:f,staticGenerationAsyncStorage:_,serverHooks:v}=y,I="/api/cart/route";function g(){return(0,a.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:_})}},82405:(e,t,r)=>{r.d(t,{G:()=>n,c:()=>s});var i=r(98691);async function s(e){return i.ZP.hash(e,10)}async function n(e,t){return i.ZP.compare(e,t)}},23174:(e,t,r)=>{r.d(t,{L:()=>u});var i=r(53797),s=r(77210),n=r(21067),a=r(77051),o=r(82405);let d=n.Ry({email:n.Z_().email(),password:n.Z_().min(3)}),u={providers:[(0,i.Z)({name:"Credentials",credentials:{email:{},password:{}},async authorize(e){let t=d.safeParse(e);if(!t.success)return null;let{email:r,password:i}=t.data,s=await a._.user.findUnique({where:{email:r}});return s&&await (0,o.G)(i,s.passwordHash)?{id:s.id,name:s.name||null,email:s.email,isAdmin:s.isAdmin}:null}}),...process.env.GITHUB_ID&&process.env.GITHUB_SECRET?[(0,s.Z)({clientId:process.env.GITHUB_ID,clientSecret:process.env.GITHUB_SECRET})]:[]],session:{strategy:"jwt"},callbacks:{async jwt({token:e,user:t}){if(t?.id)e.uid=t.id,e.isAdmin=t.isAdmin||!1;else if(e.uid&&void 0===e.isAdmin){let t=await a._.user.findUnique({where:{id:e.uid}});t&&(e.isAdmin=t.isAdmin)}return e},session:async({session:e,token:t})=>(t?.uid&&(e.user.id=t.uid),t?.isAdmin!==void 0&&(e.user.isAdmin=t.isAdmin),e)}}},77051:(e,t,r)=>{r.d(t,{_:()=>s});let i=require("@prisma/client"),s=global.__prisma||new i.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[276,550,747,59],()=>r(80330));module.exports=i})();